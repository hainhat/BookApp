{% extends "layout/base.html" %}
{% block title %}Đặt hàng thành công{% endblock %}
{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body text-center">
                    <i class="fa-regular fa-circle-check fa-shake text-success display-1"></i>
                    <h2 class="mt-3">Đặt hàng thành công!</h2>
                    <p class="lead mb-4">Mã đơn hàng: <strong>#{{ order.id }}</strong></p>

                    <!-- Trạng thái đơn hàng -->
                    <div class="alert {% if order.status.name == 'PENDING' %}alert-warning
                  {% elif order.status.name == 'PAID' %}alert-success
                  {% elif order.status.name == 'CANCELLED' %}alert-danger
                  {% endif %}">
                        <h5 class="alert-heading">Trạng thái</h5>
                        <p class="mb-2">
                            {% if order.status.name == 'PENDING' %}
                            <span class="badge bg-warning text-black-50">Chờ thanh toán</span>
                            {% elif order.status.name == 'PAID' %}
                            <span class="badge bg-success">Đã thanh toán</span>
                            {% elif order.status.name == 'CANCELLED' %}
                            <span class="badge bg-danger">Đã hủy</span>
                            {% endif %}
                        </p>

                        {% if order.payment_method.name == 'CASH' %}
                        <hr>
                        <i class="bi bi-cash"></i>
                        <p class="mb-0">Vui lòng đến nhận và thanh toán tại nhà sách (KDC Nhơn Đức, Nhà Bè)</p>
                        {% if order.status.name == 'PENDING' %}
                        <p class="mb-0">Thời hạn: <strong>{{ order.expires_at.strftime('%H:%M %d/%m/%Y') }}</strong></p>
                        {% endif %}
                        {% else %}
                        <hr>
                        <i class="fa-regular fa-credit-card"></i>
                        <p class="mb-0">Thanh toán online qua VNPay</p>
                        <p class="mb-0 mt-2">
                            <i class="fa-solid fa-truck-fast"></i> Đơn hàng sẽ được giao đến:
                            <strong>{{ order.delivery_address }}</strong>
                        </p>
                        {% endif %}
                    </div>

                    <!-- Chi tiết đơn hàng -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0 text-start">Chi tiết đơn hàng</h5>
                        </div>
                        <div class="card-body">
                            <table class="table">
                                <tbody>
                                {% for detail in order.order_details %}
                                <tr>
                                    <td class="text-start">{{ detail.book.name }}</td>
                                    <td>{{ detail.quantity }} x {{ "{:,.0f}".format(detail.unit_price) }} VND</td>
                                    <td class="text-end">{{ "{:,.0f}".format(detail.quantity * detail.unit_price) }}
                                        VND
                                    </td>
                                </tr>
                                {% endfor %}
                                <tr class="table-info">
                                    <td colspan="2" class="text-end fw-bold">Tổng cộng:</td>
                                    <td class="text-end fw-bold">{{ "{:,.0f}".format(order.total_amount) }} VND</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}